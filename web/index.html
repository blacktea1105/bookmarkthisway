<html>
<head>
<meta http-equiv="Content-type" content="text/html;charset=UTF-8">
<script src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
<script src="./libs/jtree/jstree.min.js"></script>
<script src="./libs/google-drive.js"></script>

<script type="text/javascript">
    var CLIENT_ID = '460606321746-60eoev9jsf2pqp1t37otikutqcleudmb.apps.googleusercontent.com';
    var TEST_CLIENT_ID = "460606321746-6vebbhq1ouilldot0j5khk9cinkua6cp.apps.googleusercontent.com";
    var SCOPES = 'https://www.googleapis.com/auth/drive';

    // var googleDrive = new GoogleDrive(TEST_CLIENT_ID, SCOPES);
    var googleDrive = new GoogleDrive(CLIENT_ID, SCOPES);


    // js init
    $(function() {
        // js tree
        $('#jstree').jstree({
             "plugins": ["themes", "json_data"], 
         
            'core': {
                data : {}
                // 'data': function(obj, callback) {
                //     // var items = getFoldersByRoot();
                //     // callback.call(this, items);
                //  }   
            },
            'types' : {
                'default': {'icon': 'folder'},
                'file': {'valid_children': [], 'icon': 'file'}
            },

        }).on("changed.jstree", function (e, data) {
            // console.log(data.selected);
        });

        // root folder select
        $("#pageSelect").on('change', function (e) {
            // XXX
            // refreshTree();
            // $('#jstree').jstree(true).destroy();

            var rootId = this.value;
            // XXX
            // googleDrive.getFoldersByRoot(rootId, function(item) {
            //     var parentId = item.parents[0].id == rootId ? '#' : item.parents[0].id;
                
            //     appendNode(parentId,
            //         {
            //         'id': item.id,
            //         'parent': parentId,
            //         'text': item.title
            //         }
            //     );

            // });
        });
    });

    

    /**
     * Called when the client library is loaded to start the auth flow.
     */
    function handleClientLoad() {
        googleDrive.onAuthSuccess = function() {
            authSuccess();
        };
        googleDrive.onAuthFail = function() {
            alert("auth fail");
        }
        googleDrive.auth();
    }

    /**
     * [authSuccess description]
     * @return {[type]}
     */
    function authSuccess() {
        // Access token has been successfully retrieved, requests can be sent to the API.
        googleDrive.getRootFolders(function(item) {
            // $("#pageSelect").append($("<option></option>").attr("value", item.id).text(item.title));  XXX
        }); 


//      XXX
        // // test button
        // $("#testBtn").click(function() {
        //     // $('#jstree').jstree(true).open_all();
        //     // $('#jstree').jstree(true).destroy();
        // });
    }

    // /**
    //  * [appendNode description]
    //  * @param  {String} null(or '#') if parentId if is root
    //  * @param  {[type]} node     [description]
    //  * @return {[type]}          [description]
    //  */
    // function appendNode(parentId, node) {
    //     var parent;
    //     if (parentId != null && parentId != '#') {
    //         parent = $('#' + parentId);
    //     } else {
    //         parent = parentId;
    //     }

    //     $('#jstree').jstree(true).create_node(parent, node, "last", function() {}, true);
    // }

    /**
     * [refreshTree description]
     * @return {[type]} [description]
     */
    function refreshTree() {
        $('#jstree').jstree(true).refresh();
    }   

</script>

<script type="text/javascript" src="https://apis.google.com/js/client.js?onload=handleClientLoad"></script>
<link rel="stylesheet" href="./libs/jtree/themes/default/style.min.css" />
</head>

<body>
<select id="pageSelect">
    <option value="">choose root folder...</option>
</select>

<div id="jstree">
</div>
<button>Click</button>
</body>
</html>
